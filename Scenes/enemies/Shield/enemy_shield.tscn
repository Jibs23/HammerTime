[gd_scene load_steps=15 format=3 uid="uid://cuk2crwvpedu"]

[ext_resource type="Script" uid="uid://dhjukqb0ph4qw" path="res://Scenes/enemies/Shield/enemy_shield.gd" id="1_wgm1h"]
[ext_resource type="AudioStream" uid="uid://d320jae5xt852" path="res://sound/GameSFX/Impact/Retro Impact 20.wav" id="2_pvw13"]
[ext_resource type="Script" uid="uid://gj0p8riiisk1" path="res://Scenes/enemies/Shield/shield.gd" id="2_tu8kc"]
[ext_resource type="Script" uid="uid://d3farf02gkq8e" path="res://Scripts/health.gd" id="3_hffj4"]
[ext_resource type="Shader" uid="uid://sonsxbvlf47x" path="res://shaders/flash.gdshader" id="3_ljlnt"]
[ext_resource type="AudioStream" uid="uid://wnir1qepssdh" path="res://sound/GameSFX/Impact/Retro Impact Punch Hurt 01.wav" id="3_ty8ur"]
[ext_resource type="Script" uid="uid://b3u4aiy6bgk1c" path="res://Scripts/Classes/finite_state_machine.gd" id="4_ixho8"]
[ext_resource type="Script" uid="uid://bw6hejvpvmqbb" path="res://Scripts/states/pursuit.gd" id="5_s4o70"]
[ext_resource type="Script" uid="uid://cuhbohka8opeu" path="res://Scripts/states/enemy_idle.gd" id="6_uptqb"]
[ext_resource type="Script" uid="uid://sgyeob3hmfxb" path="res://Scripts/personal_space.gd" id="8_dp0xj"]
[ext_resource type="Script" uid="uid://csrxxds2tne84" path="res://Scripts/debug_label.gd" id="9_pvw13"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_ty8ur"]
resource_local_to_scene = true
shader = ExtResource("3_ljlnt")
shader_parameter/white_to_black = 1.0
shader_parameter/intensity = 0

[sub_resource type="PhysicsMaterial" id="PhysicsMaterial_dp0xj"]
friction = 0.0
bounce = 1.0

[sub_resource type="CircleShape2D" id="CircleShape2D_tu8kc"]
radius = 91.02197

[node name="Enemy_shield" type="RigidBody2D" node_paths=PackedStringArray("health_component", "state_machine") groups=["enemy", "enemy_shield"]]
collision_layer = 4
collision_mask = 772
mass = 4.0
lock_rotation = true
contact_monitor = true
max_contacts_reported = 1
linear_damp = 3.0
script = ExtResource("1_wgm1h")
death_effect_scale = 2.0
health_component = NodePath("HealthComponent")
state_machine = NodePath("StateMachine")
death_sound = ExtResource("2_pvw13")
death_effect_color = Color(0.80784315, 0.61960787, 0.3372549, 1)
hurt_sound = ExtResource("3_ty8ur")
metadata/_custom_type_script = "uid://lp0wln500jpy"

[node name="body" type="Polygon2D" parent="."]
material = SubResource("ShaderMaterial_ty8ur")
scale = Vector2(3.7272727, 3.7272727)
color = Color(0.81, 0.62208, 0.3402, 1)
antialiased = true
polygon = PackedVector2Array(0, -10.731707, -8.585365, -8.585365, -10.731707, 0, -8.585365, 8.585365, 0, 10.731707, 8.585365, 8.585365, 10.731707, 0, 8.585365, -8.585365)

[node name="CollisionShape2D" type="CollisionPolygon2D" parent="." groups=["player"]]
visible = false
scale = Vector2(2.6000001, 2.6000001)
polygon = PackedVector2Array(-15.384616, 0, -12.307693, 12.307693, 0, 15.384616, 12.307693, 12.307693, 15.384616, 0)

[node name="Shield" type="StaticBody2D" parent="." groups=["solid"]]
collision_layer = 8
collision_mask = 264
physics_material_override = SubResource("PhysicsMaterial_dp0xj")
script = ExtResource("2_tu8kc")

[node name="shield" type="Polygon2D" parent="Shield"]
color = Color(0.86, 0.79851, 0.57619995, 1)
antialiased = true
polygon = PackedVector2Array(-56, 0, -48, -48, 0, -64, 48, -48, 56, 0, 40, 0, 31, -24, 16, -34, 9, -35, 4, -13, -4, -13, -9, -35, -17, -34, -31, -24, -40, 0)

[node name="CollisionShape2D2" type="CollisionPolygon2D" parent="Shield"]
visible = false
position = Vector2(-2.4437904e-06, -28)
scale = Vector2(2.6000001, 2.6000001)
polygon = PackedVector2Array(-21.538462, 10.769231, 21.538462, 10.769231, 18.461538, -7.6923075, 9.399194e-07, -13.846154, -18.461538, -7.6923075)

[node name="Polygon2D2" type="Polygon2D" parent="Shield"]
color = Color(1, 1, 1, 0.88235295)
antialiased = true
polygon = PackedVector2Array(8, -59, 46, -46, 32, -37, 9, -41)

[node name="Polygon2D3" type="Polygon2D" parent="Shield"]
position = Vector2(-2, 3)
rotation = -0.7853982
color = Color(1, 1, 1, 0.88235295)
antialiased = true
polygon = PackedVector2Array(0.7071078, -62.932507, 6.306175, -64.39909, 45.254837, -45.25484, 41.012196, -41.0122, 29.698486, -28.284275, 13.43503, -13.435029, 30.405594, -43.13352, 25.223988, -46.777145, 7.071068, -56.568546, -21.213203, -41.012196, -29.698486, -39.59798)

[node name="Polygon2D" type="Polygon2D" parent="Shield"]
position = Vector2(-3.9999998, 3.9999998)
scale = Vector2(0.99999994, 0.99999994)
color = Color(1, 0.74, 0.74, 0.40392157)
antialiased = true
polygon = PackedVector2Array(-16, 16, -2.724018, 22.423862, -12, 27, -6, 30, 6, 26, 17, 30, 23, 27, 12, 21, 26, 13, 18, 10, 6, 18, -7, 11)

[node name="HealthComponent" type="Node" parent="." node_paths=PackedStringArray("shape_to_flash")]
script = ExtResource("3_hffj4")
max_health = 3
shape_to_flash = NodePath("../body")
metadata/_custom_type_script = "uid://d3farf02gkq8e"

[node name="StateMachine" type="Node" parent="." node_paths=PackedStringArray("initial_state", "actor")]
script = ExtResource("4_ixho8")
show_debug = false
initial_state = NodePath("Idle")
actor = NodePath("..")
metadata/_custom_type_script = "uid://b3u4aiy6bgk1c"

[node name="Pursuit" type="Node" parent="StateMachine" node_paths=PackedStringArray("state_idle")]
script = ExtResource("5_s4o70")
target_player = true
state_idle = NodePath("../Idle")
metadata/_custom_type_script = "uid://55kpmp4krpql"

[node name="Idle" type="Node" parent="StateMachine" node_paths=PackedStringArray("move_state", "state_idle")]
script = ExtResource("6_uptqb")
move_state = NodePath("../Pursuit")
state_idle = NodePath(".")
metadata/_custom_type_script = "uid://dkheav4fupoy2"

[node name="Personal Space" type="Area2D" parent="."]
visible = false
collision_mask = 4
script = ExtResource("8_dp0xj")
valid_groups = Dictionary[String, int]({
"enemy": 0,
"enemy_flanker": 0,
"enemy_runner": 0,
"enemy_shield": 1,
"enemy_shooter": 0,
"player": 0
})

[node name="CollisionShape2D" type="CollisionShape2D" parent="Personal Space"]
shape = SubResource("CircleShape2D_tu8kc")
debug_color = Color(0.92681, 0.9257303, 1, 0.08235294)

[node name="Label" type="Label" parent="." node_paths=PackedStringArray("target_node")]
visible = false
offset_left = -28.0
offset_top = -79.0
offset_right = 24.0
offset_bottom = -56.0
text = "HP"
script = ExtResource("9_pvw13")
referenced_variable = "current_health"
target_node = NodePath("../HealthComponent")

[connection signal="hit" from="." to="HealthComponent" method="_on_value_received"]
[connection signal="tree_entered" from="." to="." method="_on_tree_entered"]
[connection signal="hit" from="Shield" to="Shield" method="_on_hit"]
[connection signal="health_empty" from="HealthComponent" to="." method="die"]
[connection signal="body_entered" from="Personal Space" to="Personal Space" method="_on_body_entered"]
[connection signal="body_exited" from="Personal Space" to="Personal Space" method="_on_body_exited"]
