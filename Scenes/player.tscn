[gd_scene load_steps=21 format=3 uid="uid://dg382sc10qhfs"]

[ext_resource type="Shader" uid="uid://sonsxbvlf47x" path="res://shaders/flash.gdshader" id="1_7dp3o"]
[ext_resource type="Script" uid="uid://dsc3muhjtycr" path="res://Scripts/player.gd" id="1_f1ek2"]
[ext_resource type="AudioStream" uid="uid://cmtiqoopq3yds" path="res://sound/sfx_player_death.ogg" id="2_pu2lt"]
[ext_resource type="PackedScene" uid="uid://dp0eg0dw3qbo2" path="res://Scenes/effects/player_effect_splash.tscn" id="2_ukyrk"]
[ext_resource type="Script" uid="uid://d3farf02gkq8e" path="res://Scripts/health.gd" id="3_gymyn"]
[ext_resource type="Script" uid="uid://bekqwb46nqc28" path="res://Scenes/effects/trail/weapon_trail.gd" id="3_pu2lt"]
[ext_resource type="PackedScene" uid="uid://cclp2idnd7odb" path="res://Scenes/effects/trail/trail.tscn" id="3_tx1dd"]
[ext_resource type="Script" uid="uid://cyjyqi8i32o3x" path="res://Scripts/states/player_idle.gd" id="5_3smsa"]
[ext_resource type="Texture2D" uid="uid://dormgc2umajb2" path="res://icon_color.svg" id="5_gymyn"]
[ext_resource type="Script" uid="uid://b3u4aiy6bgk1c" path="res://Scripts/Classes/finite_state_machine.gd" id="5_ukyrk"]
[ext_resource type="Script" uid="uid://ddfpfoed6crvm" path="res://Scripts/states/move_player.gd" id="6_3smsa"]
[ext_resource type="Script" uid="uid://sgyeob3hmfxb" path="res://Scripts/personal_space.gd" id="8_8erm5"]
[ext_resource type="Script" uid="uid://bnc6cyfk50dj" path="res://Scripts/Classes/physicsWeapon.gd" id="8_fd4e3"]
[ext_resource type="Script" uid="uid://csrxxds2tne84" path="res://Scripts/debug_label.gd" id="9_f1ek2"]

[sub_resource type="Gradient" id="Gradient_tx1dd"]
colors = PackedColorArray(1, 1, 1, 0, 1, 1, 1, 1)

[sub_resource type="PhysicsMaterial" id="PhysicsMaterial_f1ek2"]
friction = 0.0
bounce = 1.0
absorbent = true

[sub_resource type="Curve" id="Curve_ldgsr"]
_limits = [1.0, 2.0, 0.0, 1.0012499]
_data = [Vector2(0, 1), 0.0, 0.0, 0, 0, Vector2(0.9912374, 1.98), 2.4397044, 0.0, 0, 0]
point_count = 2
metadata/_snap_enabled = true
metadata/_snap_count = 100

[sub_resource type="ShaderMaterial" id="ShaderMaterial_7dp3o"]
shader = ExtResource("1_7dp3o")
shader_parameter/white_to_black = 1.0
shader_parameter/intensity = 0

[sub_resource type="CircleShape2D" id="CircleShape2D_3smsa"]
radius = 30.016663

[sub_resource type="CircleShape2D" id="CircleShape2D_f1ek2"]
radius = 58.0

[node name="Player" type="RigidBody2D" node_paths=PackedStringArray("sprite", "health_component", "state_machine") groups=["player"]]
collision_layer = 6
collision_mask = 524
mass = 2.0
sleeping = true
lock_rotation = true
contact_monitor = true
max_contacts_reported = 1
linear_damp = 2.0
script = ExtResource("1_f1ek2")
sprite = NodePath("Sprite2D")
death_effect_scene = ExtResource("2_ukyrk")
death_effect_scale = 2.0
health_component = NodePath("HealthComponent")
state_machine = NodePath("StateMachine")
death_sound = ExtResource("2_pu2lt")
death_effect_color = Color(0.2784314, 0.54901963, 0.7490196, 1)
metadata/_custom_type_script = "uid://b3rwp6d7gjlcf"

[node name="Trail" parent="." node_paths=PackedStringArray("relative_parent") instance=ExtResource("3_tx1dd")]
position = Vector2(-144, 40)
gradient = SubResource("Gradient_tx1dd")
joint_mode = 1
begin_cap_mode = 0
end_cap_mode = 0
script = ExtResource("3_pu2lt")
relative_parent = NodePath("../Weapon")

[node name="Weapon" type="RigidBody2D" parent="." node_paths=PackedStringArray("trail") groups=["projectile_deflect", "weapon"]]
position = Vector2(0, 82)
collision_layer = 256
collision_mask = 524
mass = 2.0
physics_material_override = SubResource("PhysicsMaterial_f1ek2")
center_of_mass_mode = 1
center_of_mass = Vector2(0, -75)
inertia = 1.0
continuous_cd = 2
contact_monitor = true
max_contacts_reported = 10
script = ExtResource("8_fd4e3")
trail = NodePath("../Trail")
min_dmg_speed = 400.0
max_dmg_speed = 680.0
dmg_threshold = SubResource("Curve_ldgsr")
intertia_bounce = 600.0
metadata/_custom_type_script = "uid://bnc6cyfk50dj"

[node name="PinJoint2D" type="PinJoint2D" parent="Weapon"]
position = Vector2(0, -82)
node_a = NodePath("../..")
node_b = NodePath("..")
softness = 2.0

[node name="shaft" type="Polygon2D" parent="Weapon"]
color = Color(0.77861, 0.5097214, 0.32984212, 1)
polygon = PackedVector2Array(-8, 19, -8, -82, 0, -90, 8, -82, 8, 19, 3, 22, -3, 22)

[node name="CollisionShape2D2" type="CollisionPolygon2D" parent="Weapon"]
visible = false
position = Vector2(0, 6)
rotation = 1.5707964
polygon = PackedVector2Array(-34, 1.4861873e-06, -18, 32, -2, 32, 14, 32, 22, -9.616504e-07, 14, -32, -18, -32)

[node name="Polygon2D" type="Polygon2D" parent="Weapon"]
color = Color(0.35462016, 0.44963068, 0.6788865, 1)
polygon = PackedVector2Array(-32, -12, -23, -12, -17, -7, -13, -7, -8, -9, 8, -9, 14, -7, 18, -7, 23, -12, 32, -12, 32, 20, 23, 20, 18, 16, 13, 16, 8, 17, -8, 17, -13, 16, -17, 16, -23, 20, -32, 20)

[node name="Sprite2D" type="Sprite2D" parent="."]
material = SubResource("ShaderMaterial_7dp3o")
position = Vector2(0, -5)
scale = Vector2(0.08, 0.08)
texture = ExtResource("5_gymyn")

[node name="Polygon2D" type="Polygon2D" parent="Sprite2D"]
use_parent_material = true
scale = Vector2(9.999999, 9.999999)
color = Color(0.2784314, 0.54901963, 0.7490196, 1)
polygon = PackedVector2Array(-10, 6, -35, -11, 35, -11, 10, 6, 0, -6)

[node name="Polygon2D2" type="Polygon2D" parent="Sprite2D"]
use_parent_material = true
scale = Vector2(9.999999, 9.999999)
color = Color(1, 1, 1, 0.45490196)
polygon = PackedVector2Array(-25, -15, -29, -12, -13, 0)

[node name="Polygon2D3" type="Polygon2D" parent="Sprite2D"]
use_parent_material = true
scale = Vector2(9.999999, 9.999999)
color = Color(1, 1, 1, 0.45490196)
polygon = PackedVector2Array(25, -15, 29, -12, 13, 0)

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
visible = false
shape = SubResource("CircleShape2D_3smsa")

[node name="HealthComponent" type="Node" parent="." node_paths=PackedStringArray("shape_to_flash")]
script = ExtResource("3_gymyn")
max_health = 5
shape_to_flash = NodePath("../Sprite2D")
metadata/_custom_type_script = "uid://d3farf02gkq8e"

[node name="StateMachine" type="Node" parent="." node_paths=PackedStringArray("initial_state", "actor")]
script = ExtResource("5_ukyrk")
show_debug = false
initial_state = NodePath("Idle")
actor = NodePath("..")
metadata/_custom_type_script = "uid://b3u4aiy6bgk1c"

[node name="Idle" type="Node" parent="StateMachine" node_paths=PackedStringArray("move_state", "state_idle")]
script = ExtResource("5_3smsa")
move_state = NodePath("../Move")
state_idle = NodePath(".")
metadata/_custom_type_script = "uid://dkheav4fupoy2"

[node name="Move" type="Node" parent="StateMachine" node_paths=PackedStringArray("weapon", "state_idle")]
script = ExtResource("6_3smsa")
max_move_speed = 450.0
acceleration = 2500.0
weapon = NodePath("../../Weapon")
state_idle = NodePath("../Idle")
metadata/_custom_type_script = "uid://swwpijbfoat8"

[node name="Personal Space" type="Area2D" parent="."]
visible = false
collision_mask = 4
script = ExtResource("8_8erm5")

[node name="CollisionShape2D" type="CollisionShape2D" parent="Personal Space"]
shape = SubResource("CircleShape2D_f1ek2")
debug_color = Color(0.92681, 0.9257303, 1, 0.08235294)

[node name="Swing power" type="Label" parent="." node_paths=PackedStringArray("target_node")]
visible = false
offset_left = -61.0
offset_top = -56.0
offset_right = 62.0
offset_bottom = -33.0
text = "swing power:"
script = ExtResource("9_f1ek2")
referenced_variable = "swing_power"
target_node = NodePath("../Weapon")
use_snapping = true

[node name="HP" type="Label" parent="." node_paths=PackedStringArray("target_node")]
visible = false
offset_left = -27.0
offset_top = -76.0
offset_right = 25.0
offset_bottom = -53.0
text = "HP"
script = ExtResource("9_f1ek2")
referenced_variable = "current_health"
target_node = NodePath("../HealthComponent")

[node name="speed" type="Label" parent="." node_paths=PackedStringArray("target_node")]
visible = false
offset_left = -32.0
offset_top = 32.0
offset_right = 20.0
offset_bottom = 55.0
text = "speed"
script = ExtResource("9_f1ek2")
referenced_variable = "linear_velocity"
target_node = NodePath("..")
use_snapping = true
vector_length_conversion = true

[connection signal="action_1" from="." to="StateMachine" method="_on_actor_input_action_1"]
[connection signal="action_2" from="." to="StateMachine" method="_on_actor_input_action_2"]
[connection signal="hit" from="." to="HealthComponent" method="_on_value_received"]
[connection signal="input_dir" from="." to="StateMachine" method="_on_actor_input_dir"]
[connection signal="tree_entered" from="." to="." method="_on_tree_entered"]
[connection signal="body_entered" from="Weapon" to="Weapon" method="_on_body_entered"]
[connection signal="health_empty" from="HealthComponent" to="." method="die"]
[connection signal="body_entered" from="Personal Space" to="Personal Space" method="_on_body_entered"]
[connection signal="body_exited" from="Personal Space" to="Personal Space" method="_on_body_exited"]
